(function(a,b){if('function'==typeof define&&define.amd)define(['module','serialize-error','socket.io-client'],b);else if('undefined'!=typeof exports)b(module,require('serialize-error'),require('socket.io-client'));else{var c={exports:{}};b(c,a.serializeError,a.socket),a.UneteIO=c.exports}})(this,function(a,b,c){'use strict';function d(a,d={},f=!0){function g(a){let b=p;for(let c=0,d=a.length;c<d;c++)b=b[a[c]];return b}async function h(b,...c){a instanceof Promise&&(await a),await v();let d=t(),e={};for(let a,d=0,f=c.length;d<f;d++)if(a=c[d],'function'==typeof a){let b=t();e[d]=b,p[b]=a}return a.emit('call',{path:b,iid:d,args:c,cb:e}),await new Promise((a,b)=>{j(d,a),k(d,b)})}function i(a){delete q.success[a],delete q.failure[a]}function j(a,b){q.success[a]=b}function k(a,b){q.failure[a]=b}function l(a,b=u,c=[]){for(let d in a)'object'==typeof a[d]?(b[d]||(b[d]={}),l(a[d],b[d],[...c,d])):b[d]=(...a)=>h([...c,d],...a)}function m(a){const b={};for(let c in a){let d=a[c];b[c]='object'==typeof d?m(d):e(d)}return b}function n(){a.on('call',async({path:c,iid:d,args:e,cb:f})=>{try{await v();let b=g(c);for(let a in f)e[a]=(...b)=>h([f[a]],...b);if('function'!=typeof b)throw'UNKOWN_METHOD';let i=await b.apply(u,e);a.emit('res',{iid:d,res:i})}catch(c){c instanceof Error&&(c=b(c)),console.log(c),a.emit('exc',{iid:d,exc:c})}}),a.on('res',({iid:a,res:b})=>{q.success[a]&&q.success[a](b),i(a)}),a.on('exc',({iid:a,exc:b})=>{q.failure[a]&&q.failure[a](b),i(a)}),a.on('disconnect',()=>{for(let a in q.failure)q.failure[a]('DISCONNECTED')})}d=d||{};let o;(function(){o=f?function b(c,e=[]){let f=new Proxy(function(){},{get(d,f){return'$sock'===f?a:b(c,[...e,f])},apply(a,b,d){return c&&c(e,...d)},set(a,b,c){let e=d;for(let d=0,f=c.length-1;d<f;d++)e=e[b];e[c[c.length-1]]}});return f}:function(a){return{async $connect(){let b=await a(['$public']);l(b)}}}})(),a='string'==typeof a?c.connect(a):a,a instanceof Promise?a.then(b=>{a=c.connect(b),n()}):n();let p=d,q={success:{},failure:{}},r=0,s=Math.floor(Date.now()*Math.random()),t=()=>`${s}-${++r}`,u=o(h);d.$public=()=>m(d);const v=()=>new Promise((b,c)=>a.id?b():void(a.once('connect',b),a.once('connect_error',c),a.once('error',a=>c(a))));return u}function e(a){var b=a.toString().replace(f,''),c=b.slice(b.indexOf('(')+1,b.indexOf(')')).match(g);return null===c&&(c=[]),c}a.exports=d,a.exports.NoProxy=(a,b)=>d(a,b,!1);var f=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,g=/([^\s,]+)/g});
